<% @title=@blog.title %>
<% content_for :stylesheets do %><!-- 如果这里没用，我就删除掉你！ -->
<%= stylesheet_link_tag 'default/github', 'hightlight/github.min' %>
<% end %>
<div class="left">
  <div class="con">
    <div class="content">
    	<div class="tit clearfix">
        <h1><%= link_to @blog.title, blog_path(@blog) %></h1>
        <%= link_to '', '#', :class => 'markdown' %>
        <% if account_admin? %>
        <%= link_to '', delete_blog_path(@blog), :method => :delete, :confirm => '要删除文章吗？', :class => 'del', :title => '删除' %><!-- 要用到jquery-rails插件的东西 -->
        <%= link_to '', blog_edit_path(@blog), :class => 'edit', :title => '编辑' %>
        <% end %>
      </div>
      <div class="text">
        <%= markdown(@blog.content) %>
      </div>
      <div class="info clearfix">
        <div class="fr">
          <span class="author"><%= @blog.account.name %></span>
          <span class="time"><%= time_ago_in_words(@blog.created_at) %>前发表</span>
          <span class="views" title="浏览次数"><%= @blog.view_count %>次浏览</span>
        </div>
      </div>
    </div><!-- content -->
  </div><!-- con -->
</div><!-- left -->

<div class="right">
  <%= render partial: 'blog/right' %>
</div><!-- right -->
<% content_for :javascripts do %><!-- 如果这里没用，我就删除掉你！ -->
  <%= javascript_include_tag 'highlight.min' %>
  <script type="text/javascript">
  $(function(){
    // hightlight code
    hljs.initHighlightingOnLoad();

    // response close button of weibo login div
    $('button.close').click(function() {
      $('div.box').hide();
    });

    // response sina login button
    $('button.sina_btn').click(function(){
      var width=Math.round((window.screen.width-800)/2);
      var height=Math.round((window.screen.height-600)/2);
      window.open('#', 'weibo_third_part_authentication', 'height=300px, width=400px, top='+height+',left='+width+', scrollbars=no, resizable=no, status=no, resizable=no, menubar=no');
    });
    
    // validate empty comment
    $('input.comment_btn').click(function(){
      if ($('textarea#blog_comment_content').val().length < 3) {
        $('div#comment-error-info').html('评论太少，多写点').show().fadeOut(3000);
        return false;
      }
    });
    
    // preview comments
    $('a#publish_comment').click(function(){
      $('a#publish_comment').parent().addClass('current');
      $('a#preview_comment').parent().removeClass('current');
      $('div#comment_preview').hide();
      $('textarea#blog_comment_content').show();
      return false;
    });
    $('a#preview_comment').click(function(){
      $.post('#', {term: $('textarea#blog_comment_content').val()}, function(data){
        $('a#preview_comment').parent().addClass('current');
        $('a#publish_comment').parent().removeClass('current');
        $('textarea#blog_comment_content').hide();
        $('div#comment_preview').html(data);
        $('div#comment_preview').show();
      });
      return false;
    });

    // quote comment
    $('div.cot_con a.quote_comment').click(function(){
      var commentBlock = $(this).closest('li');
      $.get('#', {id: commentBlock.attr('id')}, function(data){
        var body = $('textarea#blog_comment_content').val() + data;
        $('textarea#blog_comment_content').val(body);
        $('textarea#blog_comment_content').focus();
      });
      return false;
    });
  });
  </script>
<% end %>